services:
  - type: web
    name: inventario-backend
    runtime: docker
    # Para servicios docker, usa rootDir para establecer contexto y dockerfilePath relativo a rootDir
    rootDir: inventario-backend
    dockerfilePath: Dockerfile
    autoDeploy: true
    plan: starter
    healthCheckPath: /api/v1/health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: SSL_ENABLED
        value: "true"
      - key: CORS_ORIGINS
        # Reemplaza con la URL del frontend en Render cuando la tengas
        value: "https://inventario-frontend.onrender.com"
      - key: TRUSTED_HOSTS
        # Provide as JSON array so pydantic BaseSettings can parse it as list[str]
        value: '["localhost","127.0.0.1","inventario-backend.onrender.com"]'
      # Config DB (usa Render PostgreSQL o tu propio DBaaS)
      - key: DATABASE_URL
        # Set to your Render Postgres connection (provided by user)
        value: "postgresql://inventario_db_rmlg_user:rwA7c0H7jyJegp8FYOy89YHn9FBmT1Dh@dpg-d4dla6fpm1nc73ddcbrg-a/inventario_db_rmlg"
        sync: false
      - key: SECRET_KEY
        generateValue: true

  - type: web
    name: inventario-frontend
    runtime: static
    rootDir: inventario-frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    autoDeploy: true
    pullRequestPreviewsEnabled: false
    envVars:
      - key: VITE_API_URL
        # Reemplaza con la URL p√∫blica del backend en Render (p.ej. https://inventario-backend.onrender.com)
        value: https://inventario-backend.onrender.com
      - key: VITE_API_V1
        value: /api/v1
    headers:
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
    routes:
      - type: rewrite
        source: /(.*)
        destination: /index.html
