services:
  - type: web
    name: inventario-backend
    runtime: docker
    # Para servicios docker, usa rootDir para establecer contexto y dockerfilePath relativo a rootDir
    rootDir: inventario-backend
    dockerfilePath: Dockerfile
    autoDeploy: true
    plan: starter
    healthCheckPath: /api/v1/health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: SSL_ENABLED
        value: "true"
      - key: CORS_ORIGINS
        # Reemplaza con la URL del frontend en Render cuando la tengas
        value: "https://inventario-frontend.onrender.com"
      - key: TRUSTED_HOSTS
        value: '["localhost","127.0.0.1","inventario-backend.onrender.com"]'
      - key: DATABASE_URL
        value: "postgresql://inventario_db_rmlg_user:rwA7c0H7jyJegp8FYOy89YHn9FBmT1Dh@dpg-d4dla6fpm1nc73ddcbrg-a/inventario_db_rmlg"
        sync: false
      - key: SECRET_KEY
        generateValue: true

  - type: web
    runtime: static
    name: inventario-frontend
    rootDir: inventario-frontend
    buildCommand: npm ci && npm run build:mobile
    staticPublishPath: dist
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        value: https://inventario-backend.onrender.com
      - key: VITE_API_V1
        value: /api/v1
