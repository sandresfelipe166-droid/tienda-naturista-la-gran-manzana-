// M√©tricas con iconos coloridos (estilo primera imagen)
const metrics = [
  {
    label: 'Ventas',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="15" rx="2" fill="#7c3aed"/><path d="M8 11h8M8 14h5" stroke="#fff" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#ede9fe',
    iconColor: '#7c3aed',
  },
  {
    label: 'Retorno de ventas',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke="#f59e0b" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M4 12h12" stroke="#f59e0b" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#fef3c7',
    iconColor: '#f59e0b',
  },
  {
    label: 'Retorno de compra',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><rect x="4" y="4" width="16" height="16" rx="3" fill="#10b981"/><path d="M8 12l2 2 4-4" stroke="#fff" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    bgColor: '#d1fae5',
    iconColor: '#10b981',
  },
  {
    label: 'Lucro',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" fill="#3b82f6"/><path d="M12 8v8M8 12h8" stroke="#fff" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#dbeafe',
    iconColor: '#3b82f6',
  },
]
import { useNavigate } from 'react-router-dom'
import { useAuthStore } from '@/store/authStore'
import { useProducts } from '@/hooks/useProducts'
import './DashboardPage.css'
import { useState } from 'react'

// M√©tricas con iconos coloridos (estilo primera imagen)
const metrics = [
  {
    label: 'Ventas',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="15" rx="2" fill="#7c3aed"/><path d="M8 11h8M8 14h5" stroke="#fff" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#ede9fe',
    iconColor: '#7c3aed',
  },
  {
    label: 'Retorno de ventas',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke="#f59e0b" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M4 12h12" stroke="#f59e0b" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#fef3c7',
    iconColor: '#f59e0b',
  },
  {
    label: 'Retorno de compra',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><rect x="4" y="4" width="16" height="16" rx="3" fill="#10b981"/><path d="M8 12l2 2 4-4" stroke="#fff" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    bgColor: '#d1fae5',
    iconColor: '#10b981',
  },
  {
    label: 'Lucro',
    value: '0.00',
    icon: <svg width="32" height="32" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" fill="#3b82f6"/><path d="M12 8v8M8 12h8" stroke="#fff" strokeWidth="2" strokeLinecap="round"/></svg>,
    bgColor: '#dbeafe',
    iconColor: '#3b82f6',
  },
]

const sidebarMenu = [
  { id: 'panel', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/><rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor"/><rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/><rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor"/></svg>, label: 'PANEL DE CONTROL' },
  { id: 'produtos', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="4" y="7" width="16" height="11" rx="2" stroke="currentColor" strokeWidth="2" fill="none"/><rect x="7" y="4" width="10" height="3" rx="1.5" fill="currentColor"/></svg>, label: 'PRODUCTOS' },
  { id: 'compra', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>, label: 'COMPRA' },
  { id: 'venda', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>, label: 'VENTAS' },
  { id: 'despesa', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" strokeWidth="2" fill="none"/></svg>, label: 'GASTOS' },
  { id: 'cotacao', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h10" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>, label: 'COTIZACI√ìN' },
  { id: 'transferir', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" strokeWidth="2" fill="none"/><path d="M7 10h10M7 14h6" stroke="currentColor" strokeWidth="1.5"/></svg>, label: 'TRANSFERIR' },
  { id: 'retorna', icon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>, label: 'DEVOLUCIONES' },
]

export default function DashboardPage() {
  const navigate = useNavigate()
  const { user, logout } = useAuthStore()
  const { data: productsData, isLoading: productsLoading } = useProducts()
  const [activeView, setActiveView] = useState('panel')

  const handleLogout = () => {
    logout()
    navigate('/login')
  }

  const productos = Array.isArray(productsData?.items)
    ? productsData.items
    : Array.isArray(productsData)
      ? productsData
      : []

  // Calcular m√©tricas reales
  const totalProductos = productos.length
  const stockBajo = productos.filter(p => p.cantidad <= 5).length
  const valorTotal = productos.reduce((sum, p) => sum + (p.precio * p.cantidad), 0)

  return (
    <div className="dashboard-layout">
      <aside className="sidebar">
        <div className="sidebar-logo">
          <img src="/images/logo.png" alt="Logo" />
        </div>
        <nav className="sidebar-menu">
          {sidebarMenu.map((item) => (
            <div key={item.label} className="sidebar-item">
              <span className="sidebar-icon">{item.icon}</span>
              <span className="sidebar-label">{item.label}</span>
            </div>
          ))}
        </nav>
      </aside>

      <div className="dashboard-main-area">
        <header className="dashboard-header">
          <div className="header-content">
            <h1>Sistema de Inventario</h1>
            <div className="user-info">
              <span className="user-name">üë§ {user?.nombre || 'Usuario'}</span>
              <button onClick={handleLogout} className="logout-button">
                Cerrar Sesi√≥n
              </button>
            </div>
          </div>
        </header>

        <main className="dashboard-main">
          {/* M√©tricas */}
          <div className="metrics-row">
            {metrics.map((m) => (
              <div className="metric-card modern" key={m.label} style={{ backgroundColor: m.bgColor }}>
                <div className="metric-icon-circle" style={{ backgroundColor: m.iconColor }}>
                  {m.icon}
                </div>
                <div className="metric-info">
                  <span className="metric-label">{m.label}</span>
                  <span className="metric-value">{m.value}</span>
                </div>
              </div>
            ))}
          </div>

          {/* Layout de 2 columnas */}
          <div className="dashboard-grid">
            {/* Columna izquierda */}
            <div className="dashboard-column">
              <div className="dashboard-section">
                <h2>Panel de Control</h2>
                <div className="welcome-card">
                  <div className="welcome-content">
                    <div className="welcome-icon">
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" fill="#2E8B57"/>
                        <path d="M8 12l2 2 4-4" stroke="#fff" strokeWidth="2" strokeLinecap="round"/>
                      </svg>
                    </div>
                    <div className="welcome-text">
                      <h3>¬°Bienvenido, {user?.nombre}!</h3>
                      <p>Gestiona tu inventario de forma eficiente y profesional.</p>
                    </div>
                  </div>
                </div>
              </div>

              <div className="dashboard-section">
                <div className="section-header">
                  <h2>Actividad Reciente</h2>
                </div>
                <div className="activity-card">
                  <div className="activity-item">
                    <div className="activity-icon">üì¶</div>
                    <div className="activity-text">
                      <p className="activity-title">Producto agregado</p>
                      <p className="activity-time">Hace 2 horas</p>
                    </div>
                  </div>
                  <div className="activity-item">
                    <div className="activity-icon">‚úÖ</div>
                    <div className="activity-text">
                      <p className="activity-title">Venta realizada</p>
                      <p className="activity-time">Hace 4 horas</p>
                    </div>
                  </div>
                  <div className="activity-item">
                    <div className="activity-icon">‚ö†Ô∏è</div>
                    <div className="activity-text">
                      <p className="activity-title">Stock bajo detectado</p>
                      <p className="activity-time">Hace 1 d√≠a</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Columna derecha */}
            <div className="dashboard-column">
              <div className="dashboard-section">
                <div className="section-header">
                  <h2>Productos Destacados</h2>
                  <button className="view-all-btn">Ver todos ‚Üí</button>
                </div>
                {productsLoading ? (
                  <p>Cargando productos...</p>
                ) : productos.length > 0 ? (
                  <div className="products-list">
                    {productos.slice(0, 6).map((producto) => {
                      const isLowStock = producto.cantidad <= 5;
                      return (
                        <div key={producto.id} className={`product-card compact${isLowStock ? ' low-stock' : ''}`}>
                          <div className="product-card-header">
                            <span className="product-icon">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect x="4" y="7" width="16" height="11" rx="2" fill="#2E8B57"/>
                                <rect x="7" y="4" width="10" height="3" rx="1.5" fill="#86c8bc"/>
                              </svg>
                            </span>
                            <h3>{producto.nombre}</h3>
                          </div>
                          <div className="product-info">
                            <span className={`cantidad${isLowStock ? ' alert' : ''}`}>
                              Stock: {producto.cantidad}
                              {isLowStock && <span className="alert-icon">‚ö†Ô∏è</span>}
                            </span>
                            <span className="precio">${producto.precio}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                ) : (
                  <p>No hay productos disponibles</p>
                )}
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  )
}
